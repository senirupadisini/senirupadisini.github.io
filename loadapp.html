<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <style>
      * { box-sizing: border-box; margin: 0; padding: 0; }
      body { overflow: hidden; background: black; }
      a-scene, canvas {
        width: 100vw !important; height: 100vh !important;
        position: fixed !important; top: 0 !important; left: 0 !important;
      }

      #ar-start {
        position: fixed; inset: 0;
        background: black; color: white;
        display: flex; flex-direction: column;
        justify-content: center; align-items: center;
        gap: 24px; z-index: 9999;
        font-family: sans-serif; text-align: center;
        padding: 30px;
      }
      #ar-start p { font-size: 1.3em; line-height: 1.5; }
      #btn-start {
        background: white; color: black;
        border: none; border-radius: 50px;
        padding: 20px 50px; font-size: 1.4em;
        font-weight: bold; cursor: pointer;
        font-family: sans-serif;
      }

      #error-msg {
        display: none;
        position: fixed; bottom: 20px; left: 0; width: 100%;
        text-align: center; color: red; font-family: sans-serif;
        font-size: 1em; z-index: 9999; padding: 0 16px;
      }

      #unmute-btn {
        display: none;
        position: fixed; bottom: 36px; left: 50%; transform: translateX(-50%);
        background: rgba(0,0,0,0.75); color: white; border: 2.5px solid white;
        border-radius: 50px; padding: 16px 36px; font-size: 1.2em;
        font-family: sans-serif; cursor: pointer; z-index: 9999;
        white-space: nowrap;
      }

      #lang-panel {
        display: none;
        position: fixed; bottom: 36px; left: 50%; transform: translateX(-50%);
        z-index: 9999;
        flex-direction: column; align-items: center; gap: 16px;
      }
      #lang-panel.active { display: flex; }

      #lang-name {
        color: white; font-family: sans-serif; font-size: 1.2em; font-weight: bold;
        background: rgba(0,0,0,0.7); padding: 8px 28px; border-radius: 30px;
        letter-spacing: 1px; white-space: nowrap;
      }
      .lang-buttons { display: flex; gap: 16px; }
      .lang-btn {
        background: rgba(0,0,0,0.8); color: white;
        border: 2.5px solid white; border-radius: 50px;
        padding: 16px 32px; font-size: 1.2em;
        font-family: sans-serif; cursor: pointer; white-space: nowrap;
      }
      .lang-btn.active-lang { background: white; color: black; }
    </style>
  </head>
  <body>

    <div id="ar-start">
      <p>Ketuk tombol di bawah untuk memulai AR dan izinkan akses kamera</p>
      <button id="btn-start">üì∑ Mulai AR</button>
    </div>

    <div id="error-msg"></div>
    <button id="unmute-btn">üîä Ketuk untuk aktifkan suara</button>

    <!-- Audio -->
    <audio id="audio-lim-id" src="https://senirupadisini.github.io/audio_lim_kwi_bing_id.mp3"   preload="auto"></audio>
    <audio id="audio-lim-en" src="https://senirupadisini.github.io/audio_lim_kwi_bing.mp3"      preload="auto"></audio>

    <audio id="audio-ong-id" src="https://senirupadisini.github.io/audio_ong_kian_bie_id.mp3"   preload="auto"></audio>
    <audio id="audio-ong-en" src="https://senirupadisini.github.io/audio_ong_kian_bie.mp3"      preload="auto"></audio>

    <audio id="audio-kkb-id" src="https://senirupadisini.github.io/audio_kho_khiem_bing_id.mp3" preload="auto"></audio>
    <audio id="audio-kkb-en" src="https://senirupadisini.github.io/audio_kho_khiem_bing.mp3"    preload="auto"></audio>

    <audio id="audio-tlp-id" src="https://senirupadisini.github.io/audio_tan_liep_poen_id.mp3"  preload="auto"></audio>
    <audio id="audio-tlp-en" src="https://senirupadisini.github.io/audio_tan_liep_poen.mp3"     preload="auto"></audio>

    <!-- Panel bahasa -->
    <div id="lang-panel">
      <div id="lang-name">-</div>
      <div class="lang-buttons">
        <button class="lang-btn" id="btn-id">üáÆüá© Indonesia</button>
        <button class="lang-btn" id="btn-en">üåê English</button>
      </div>
    </div>

    <a-scene
      mindar-image="imageTargetSrc: https://senirupadisini.github.io/multitargets.mind; autoStart: false;"
      color-space="sRGB"
      renderer="colorManagement: true, physicallyCorrectLights"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false">

      <a-assets>
        <video id="video-widagdo" src="https://senirupadisini.github.io/video_widagdo.mp4"
               playsinline webkit-playsinline loop preload="auto" crossorigin="anonymous"></video>
        <video id="video-does" src="https://senirupadisini.github.io/video_does.mp4"
               playsinline webkit-playsinline loop preload="auto" crossorigin="anonymous"></video>
        <a-asset-item id="model-tlp" src="https://senirupadisini.github.io/model_tan_liep_poen.glb"></a-asset-item>
        <a-asset-item id="model-kkb" src="https://senirupadisini.github.io/model_kho_khiem_bing.glb"></a-asset-item>
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <!-- targetIndex 0 = Lim Kwi Bing ‚Üí image marker + audio -->
      <a-entity id="target-lim" mindar-image-target="targetIndex: 0">
        <a-image src="https://senirupadisini.github.io/lim_kwi_bing_marker.jpg" position="0 0 0" width="1" height="1"></a-image>
      </a-entity>

      <!-- targetIndex 1 = Ong Kian Bie ‚Üí image marker + audio -->
      <a-entity id="target-ong" mindar-image-target="targetIndex: 1">
        <a-image src="https://senirupadisini.github.io/OngKian_Bie_marker.jpg" position="0 0 0" width="1" height="1"></a-image>
      </a-entity>

      <!-- targetIndex 2 = Kho Khiem Bing ‚Üí 3D model + audio -->
      <a-entity id="target-kkb" mindar-image-target="targetIndex: 2">
        <a-gltf-model src="#model-kkb" position="0 0 0" scale="1.90 1.90 1.90" rotation="0 0 0"></a-gltf-model>
      </a-entity>

      <!-- targetIndex 3 = Tan Liep Poen ‚Üí 3D model + audio -->
      <a-entity id="target-tlp" mindar-image-target="targetIndex: 3">
        <a-gltf-model src="#model-tlp" position="0 0 0" scale="1.90 1.90 1.90" rotation="90 0 90"></a-gltf-model>
      </a-entity>

      <!-- targetIndex 4 = Widagdo ‚Üí video -->
      <a-entity id="target-widagdo" mindar-image-target="targetIndex: 4">
        <a-video src="#video-widagdo" position="0 0 0" width="1" height="0.56"></a-video>
      </a-entity>

      <!-- targetIndex 5 = Van der Does ‚Üí video -->
      <a-entity id="target-does" mindar-image-target="targetIndex: 5">
        <a-video src="#video-does" position="0 0 0" width="1" height="0.56"></a-video>
      </a-entity>

    </a-scene>

    <script>
      const sceneEl   = document.querySelector('a-scene');
      const arStart   = document.getElementById('ar-start');
      const btnStart  = document.getElementById('btn-start');
      const errorMsg  = document.getElementById('error-msg');
      const unmuteBtn = document.getElementById('unmute-btn');
      const langPanel = document.getElementById('lang-panel');
      const langName  = document.getElementById('lang-name');
      const btnId     = document.getElementById('btn-id');
      const btnEn     = document.getElementById('btn-en');

      const videoWidagdo = document.getElementById('video-widagdo');
      const videoDoes    = document.getElementById('video-does');
      let activeVideo  = null;
      let activeTarget = null; // akan berisi object { id, en, name }

      // ‚îÄ‚îÄ Definisi audio per seniman, dipanggil lewat ID elemen secara eksplisit ‚îÄ‚îÄ
      const seniman = {
        lim: {
          name: 'Lim Kwi Bing',
          id:   document.getElementById('audio-lim-id'),
          en:   document.getElementById('audio-lim-en'),
        },
        ong: {
          name: 'Ong Kian Bie',
          id:   document.getElementById('audio-ong-id'),
          en:   document.getElementById('audio-ong-en'),
        },
        kkb: {
          name: 'Kho Khiem Bing',
          id:   document.getElementById('audio-kkb-id'),
          en:   document.getElementById('audio-kkb-en'),
        },
        tlp: {
          name: 'Tan Liep Poen',
          id:   document.getElementById('audio-tlp-id'),
          en:   document.getElementById('audio-tlp-en'),
        },
      };

      function stopAllAudio() {
        Object.values(seniman).forEach(s => {
          [s.id, s.en].forEach(a => { try { a.pause(); a.currentTime = 0; } catch(e){} });
        });
      }

      function stopAllVideo() {
        [videoWidagdo, videoDoes].forEach(v => {
          try { v.pause(); v.currentTime = 0; } catch(e){}
        });
        activeVideo = null;
        unmuteBtn.style.display = 'none';
      }

      function stopAll() {
        stopAllAudio();
        stopAllVideo();
        hidePanel();
      }

      function showPanel(senimanObj) {
        activeTarget = senimanObj;
        langName.textContent = senimanObj.name;
        btnId.classList.remove('active-lang');
        btnEn.classList.remove('active-lang');
        langPanel.classList.add('active');
      }

      function hidePanel() {
        langPanel.classList.remove('active');
        activeTarget = null;
        btnId.classList.remove('active-lang');
        btnEn.classList.remove('active-lang');
      }

      btnId.addEventListener('click', () => {
        if (!activeTarget) return;
        stopAllAudio();
        activeTarget.id.play().catch(e => console.error(e));
        btnId.classList.add('active-lang');
        btnEn.classList.remove('active-lang');
      });

      btnEn.addEventListener('click', () => {
        if (!activeTarget) return;
        stopAllAudio();
        activeTarget.en.play().catch(e => console.error(e));
        btnEn.classList.add('active-lang');
        btnId.classList.remove('active-lang');
      });

      unmuteBtn.addEventListener('click', () => {
        if (activeVideo) { activeVideo.muted = false; activeVideo.play().catch(e=>{}); }
        unmuteBtn.style.display = 'none';
      });

      function showError(msg) {
        errorMsg.style.display = 'block';
        errorMsg.textContent = msg;
      }

      async function startAR() {
        try {
          await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
        } catch(e) {
          showError('Akses kamera ditolak. Izinkan kamera di pengaturan browser.');
          return;
        }
        arStart.style.display = 'none';
        try {
          await sceneEl.systems['mindar-image-system'].start();
        } catch(e) {
          showError('Gagal memulai AR: ' + e.message);
        }
      }

      btnStart.addEventListener('click', startAR);
      sceneEl.addEventListener('arError', (e) => showError('AR Error: ' + (e.detail || 'Unknown')));

      sceneEl.addEventListener('arReady', () => {

        // ‚îÄ‚îÄ Gunakan getElementById, BUKAN querySelectorAll + index array ‚îÄ‚îÄ

        const tLim     = document.getElementById('target-lim');
        const tOng     = document.getElementById('target-ong');
        const tKkb     = document.getElementById('target-kkb');
        const tTlp     = document.getElementById('target-tlp');
        const tWidagdo = document.getElementById('target-widagdo');
        const tDoes    = document.getElementById('target-does');

        // targetIndex 0 ‚Üí Lim Kwi Bing
        tLim.addEventListener('targetFound', () => { stopAll(); showPanel(seniman.lim); });
        tLim.addEventListener('targetLost',  () => stopAll());

        // targetIndex 1 ‚Üí Ong Kian Bie
        tOng.addEventListener('targetFound', () => { stopAll(); showPanel(seniman.ong); });
        tOng.addEventListener('targetLost',  () => stopAll());

        // targetIndex 2 ‚Üí Kho Khiem Bing
        tKkb.addEventListener('targetFound', () => { stopAll(); showPanel(seniman.kkb); });
        tKkb.addEventListener('targetLost',  () => stopAll());

        // targetIndex 3 ‚Üí Tan Liep Poen
        tTlp.addEventListener('targetFound', () => { stopAll(); showPanel(seniman.tlp); });
        tTlp.addEventListener('targetLost',  () => stopAll());

        // targetIndex 4 ‚Üí Video Widagdo
        tWidagdo.addEventListener('targetFound', () => {
          stopAll();
          activeVideo = videoWidagdo;
          videoWidagdo.muted = true;
          videoWidagdo.play().catch(e=>{});
          unmuteBtn.style.display = 'block';
        });
        tWidagdo.addEventListener('targetLost', () => stopAll());

        // targetIndex 5 ‚Üí Video Van der Does
        tDoes.addEventListener('targetFound', () => {
          stopAll();
          activeVideo = videoDoes;
          videoDoes.muted = true;
          videoDoes.play().catch(e=>{});
          unmuteBtn.style.display = 'block';
        });
        tDoes.addEventListener('targetLost', () => stopAll());

      });
    </script>
  </body>
</html>
