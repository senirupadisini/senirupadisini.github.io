<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Permainan Cari Kata ‚Äì Level 4</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Merriweather:wght@700&family=Nunito:wght@400;600;700;800&display=swap');

    :root {
      --primary: #6A0572;
      --primary-light: #9C27B0;
      --accent: #E91E8C;
      --bg: #FDF0FF;
      --card: #FFFFFF;
      --text: #2A0A2E;
      --muted: #7B5F80;
      --border: #DDB8E8;
      --found: #1B5E20;
      --found-bg: #C8E6C9;
      --cell-size: min(9vw, 38px);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

    body {
      font-family: 'Nunito', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* HEADER */
    .header {
      background: linear-gradient(135deg, var(--primary) 0%, #3A0042 100%);
      padding: 20px 16px 16px;
      text-align: center;
    }
    .header h1 {
      font-family: 'Merriweather', serif;
      font-size: clamp(16px, 4.5vw, 24px);
      color: #F8E8FF;
      text-shadow: 0 2px 6px rgba(0,0,0,0.35);
    }
    .header p {
      color: #F48FB1;
      font-size: 11px;
      margin-top: 4px;
      letter-spacing: 2px;
      text-transform: uppercase;
    }
    .level-badge {
      display: inline-block;
      background: var(--accent);
      color: #fff;
      font-size: 9px;
      font-weight: 700;
      padding: 2px 10px;
      border-radius: 20px;
      letter-spacing: 1.5px;
      margin-top: 6px;
      text-transform: uppercase;
    }

    /* SCORE BAR */
    .scorebar {
      display: flex;
      justify-content: center;
      gap: 20px;
      background: rgba(106,5,114,0.07);
      border-bottom: 1px solid var(--border);
      padding: 8px 16px;
      font-size: 13px;
      font-weight: 700;
    }
    .score-item { display: flex; align-items: center; gap: 5px; }
    .score-item span { color: var(--primary); font-size: 15px; }

    /* LAYOUT */
    .game-wrap {
      max-width: 760px;
      margin: 0 auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    /* GRID */
    .grid-section {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px;
      box-shadow: 0 2px 12px rgba(106,5,114,0.1);
    }
    .grid-title {
      font-size: 11px; letter-spacing: 1.5px; text-transform: uppercase;
      color: var(--muted); margin-bottom: 10px; text-align: center;
    }

    #ws-grid {
      display: inline-grid;
      gap: 2px;
      width: 100%;
      justify-content: center;
      touch-action: none;
    }

    .ws-cell {
      width: var(--cell-size);
      height: var(--cell-size);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: calc(var(--cell-size) * 0.45);
      font-weight: 800;
      border-radius: 5px;
      background: #FBF0FF;
      border: 1px solid #E5C8F0;
      cursor: pointer;
      transition: background 0.15s, color 0.15s, transform 0.1s;
      user-select: none;
      -webkit-user-select: none;
      text-transform: uppercase;
      color: var(--text);
      line-height: 1;
    }
    .ws-cell:hover { background: #F0C8FF; }
    .ws-cell.selected {
      background: var(--accent) !important;
      color: #FFF !important;
      transform: scale(1.08);
      border-color: var(--accent);
    }
    .ws-cell.found {
      background: var(--found-bg) !important;
      color: var(--found) !important;
      border-color: #A5D6A7;
      font-weight: 900;
    }

    /* WORD LIST */
    .words-section {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px;
      box-shadow: 0 2px 12px rgba(106,5,114,0.1);
    }
    .words-title {
      font-size: 11px; letter-spacing: 1.5px; text-transform: uppercase;
      color: var(--muted); margin-bottom: 10px;
    }
    .ws-words {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      list-style: none;
    }
    .ws-word {
      padding: 6px 14px;
      background: #FBF0FF;
      border: 2px solid var(--border);
      border-radius: 20px;
      font-size: 13px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      transition: all 0.3s;
      color: var(--text);
    }
    .ws-word.found {
      background: var(--found-bg);
      border-color: #A5D6A7;
      color: var(--found);
      text-decoration: line-through;
      opacity: 0.7;
    }

    /* WIN MODAL */
    .modal-overlay {
      display: none;
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.6);
      z-index: 100;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .modal-overlay.show { display: flex; }
    .modal {
      background: var(--card);
      border-radius: 20px;
      padding: 32px 28px;
      text-align: center;
      max-width: 340px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.4);
      border: 2px solid var(--accent);
      animation: popIn 0.4s cubic-bezier(0.175,0.885,0.32,1.275);
    }
    @keyframes popIn {
      from { transform: scale(0.7); opacity: 0; }
      to   { transform: scale(1);   opacity: 1; }
    }
    .modal .trophy { font-size: 60px; margin-bottom: 12px; }
    .modal h2 {
      font-family: 'Merriweather', serif;
      font-size: 22px; color: var(--primary); margin-bottom: 8px;
    }
    .modal p { font-size: 14px; color: var(--muted); margin-bottom: 20px; line-height: 1.6; }
    .modal-btns { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
    .btn-modal {
      padding: 12px 22px;
      border-radius: 50px;
      font-family: 'Nunito', sans-serif;
      font-size: 14px; font-weight: 700;
      cursor: pointer; border: none; text-decoration: none;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .btn-modal:hover { transform: translateY(-2px); }
    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      color: #F8E8FF;
      box-shadow: 0 4px 14px rgba(106,5,114,0.4);
    }
    .btn-secondary {
      background: var(--bg);
      color: var(--primary);
      border: 2px solid var(--border);
    }

    .hint-bar {
      text-align: center;
      font-size: 11px;
      color: var(--muted);
      padding: 6px 0 0;
      letter-spacing: 0.5px;
    }
  </style>
</head>
<body>

<div class="header">
  <h1>üîç Permainan Cari Kata</h1>
  <p>Seni & Tradisi ‚Äì Cerita Panji</p>
  <div class="level-badge">üé≠ Level 4</div>
</div>

<div class="scorebar">
  <div class="score-item">üéØ Ditemukan: <span id="foundCount">0</span></div>
  <div class="score-item">üìã Total: <span id="totalCount">0</span></div>
  <div class="score-item">‚è±Ô∏è <span id="timer">0:00</span></div>
</div>

<div class="game-wrap">
  <div class="grid-section">
    <div class="grid-title">Klik/sentuh dan seret untuk memilih kata</div>
    <div id="ws-grid"></div>
    <div class="hint-bar">‚Üî Horizontal &nbsp;¬∑&nbsp; ‚Üï Vertikal &nbsp;¬∑&nbsp; ‚Üó Diagonal</div>
  </div>

  <div class="words-section">
    <div class="words-title">Kata yang dicari:</div>
    <ul class="ws-words" id="ws-words"></ul>
  </div>
</div>

<!-- WIN MODAL -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <div class="trophy">üèÜ</div>
    <h2>Luar Biasa!</h2>
    <p>Kamu berhasil menemukan semua kata dalam waktu <strong id="finalTime"></strong>.<br>Kamu menguasai Level 4!</p>
    <div class="modal-btns">
      <button class="btn-modal btn-secondary" onclick="restartGame()">üîÑ Main Lagi</button>
      <a href="dictio3.html" class="btn-modal btn-primary">üìñ Kembali</a>
    </div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// KATA LEVEL 4 ‚Äî Seni & Tradisi Panji
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const WORDS = [
  'TOPENG',
  'WAYANG',
  'LEGONG',
  'INAO',
  'MACAPAT',
  'MALAT',
  'GEDOG',
  'KIDUNG',
  'LAKHON',
  'ASMARADANA',
  'KINANTHI',
];

const GRID_SIZE = 15;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let grid = [];
let placed = {};
let selectedCells = [];
let isDragging = false;
let foundWords = new Set();
let startCell = null;
let timerInterval = null;
let seconds = 0;

function startTimer() {
  seconds = 0;
  clearInterval(timerInterval);
  timerInterval = setInterval(() => {
    seconds++;
    const m = Math.floor(seconds / 60);
    const s = String(seconds % 60).padStart(2, '0');
    document.getElementById('timer').textContent = `${m}:${s}`;
  }, 1000);
}
function stopTimer() { clearInterval(timerInterval); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// GRID GENERATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const DIRECTIONS = [
  [0,1],[0,-1],[1,0],[-1,0],
  [1,1],[1,-1],[-1,1],[-1,-1]
];

function emptyGrid(size) {
  return Array.from({length: size}, () => Array(size).fill(''));
}

function placeWord(g, word, r, c, dr, dc) {
  const cells = [];
  for (let i = 0; i < word.length; i++) {
    const nr = r + i * dr, nc = c + i * dc;
    if (nr < 0 || nr >= GRID_SIZE || nc < 0 || nc >= GRID_SIZE) return null;
    if (g[nr][nc] !== '' && g[nr][nc] !== word[i]) return null;
    cells.push({r: nr, c: nc});
  }
  cells.forEach((pos, i) => { g[pos.r][pos.c] = word[i]; });
  return cells;
}

function fillRandom(g) {
  const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
  for (let r = 0; r < GRID_SIZE; r++)
    for (let c = 0; c < GRID_SIZE; c++)
      if (g[r][c] === '') g[r][c] = letters[Math.floor(Math.random() * letters.length)];
}

function buildGrid() {
  grid = emptyGrid(GRID_SIZE);
  placed = {};
  const sortedWords = [...WORDS].map(w => w.toUpperCase()).sort((a,b) => b.length - a.length);
  for (const word of sortedWords) {
    let success = false;
    for (let attempt = 0; attempt < 300 && !success; attempt++) {
      const [dr, dc] = DIRECTIONS[Math.floor(Math.random() * DIRECTIONS.length)];
      const r = Math.floor(Math.random() * GRID_SIZE);
      const c = Math.floor(Math.random() * GRID_SIZE);
      const cells = placeWord(grid, word, r, c, dr, dc);
      if (cells) { placed[word] = cells; success = true; }
    }
  }
  fillRandom(grid);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderGrid() {
  const container = document.getElementById('ws-grid');
  container.innerHTML = '';
  container.style.gridTemplateColumns = `repeat(${GRID_SIZE}, var(--cell-size))`;
  for (let r = 0; r < GRID_SIZE; r++) {
    for (let c = 0; c < GRID_SIZE; c++) {
      const cell = document.createElement('div');
      cell.className = 'ws-cell';
      cell.textContent = grid[r][c];
      cell.dataset.r = r;
      cell.dataset.c = c;
      container.appendChild(cell);
    }
  }
}

function renderWords() {
  const ul = document.getElementById('ws-words');
  ul.innerHTML = '';
  WORDS.forEach(w => {
    const li = document.createElement('li');
    li.className = 'ws-word' + (foundWords.has(w.toUpperCase()) ? ' found' : '');
    li.textContent = w.toUpperCase();
    li.id = 'word-' + w.toUpperCase();
    ul.appendChild(li);
  });
  document.getElementById('foundCount').textContent = foundWords.size;
  document.getElementById('totalCount').textContent = WORDS.length;
}

function updateCellStyles() {
  document.querySelectorAll('.ws-cell').forEach(el => {
    const r = +el.dataset.r, c = +el.dataset.c;
    const isSelected = selectedCells.some(sc => sc.r === r && sc.c === c);
    const isFound = [...foundWords].some(w => placed[w] && placed[w].some(p => p.r === r && p.c === c));
    el.className = 'ws-cell' + (isFound ? ' found' : '') + (isSelected && !isFound ? ' selected' : '');
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SELECTION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getCellsInLine(start, end) {
  const dr = Math.sign(end.r - start.r);
  const dc = Math.sign(end.c - start.c);
  const rowDiff = Math.abs(end.r - start.r);
  const colDiff = Math.abs(end.c - start.c);
  if (rowDiff !== colDiff && rowDiff !== 0 && colDiff !== 0) return [];
  const cells = [];
  let r = start.r, c = start.c;
  while (true) {
    cells.push({r, c});
    if (r === end.r && c === end.c) break;
    r += dr; c += dc;
  }
  return cells;
}

function checkSelection() {
  const selected = selectedCells.map(sc => grid[sc.r][sc.c]).join('');
  const reversed = selected.split('').reverse().join('');
  for (const word of Object.keys(placed)) {
    if (!foundWords.has(word) && (selected === word || reversed === word)) {
      foundWords.add(word);
      updateCellStyles();
      const li = document.getElementById('word-' + word);
      if (li) li.classList.add('found');
      document.getElementById('foundCount').textContent = foundWords.size;
      selectedCells = [];
      updateCellStyles();
      if (foundWords.size === Object.keys(placed).length) {
        stopTimer();
        setTimeout(showWin, 500);
      }
      return;
    }
  }
  selectedCells = [];
  updateCellStyles();
}

function showWin() {
  const m = Math.floor(seconds / 60);
  const s = String(seconds % 60).padStart(2, '0');
  document.getElementById('finalTime').textContent = `${m}:${s}`;
  document.getElementById('modalOverlay').classList.add('show');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EVENTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function onStart(r, c) {
  isDragging = true; startCell = {r, c};
  selectedCells = [{r, c}]; updateCellStyles();
}
function onMove(r, c) {
  if (!isDragging || !startCell) return;
  selectedCells = getCellsInLine(startCell, {r, c});
  updateCellStyles();
}
function onEnd() {
  if (!isDragging) return;
  isDragging = false;
  if (selectedCells.length > 1) checkSelection();
  else { selectedCells = []; updateCellStyles(); }
  startCell = null;
}

function initEvents() {
  const container = document.getElementById('ws-grid');
  container.addEventListener('mousedown', e => {
    const el = e.target.closest('.ws-cell');
    if (el) onStart(+el.dataset.r, +el.dataset.c);
  });
  container.addEventListener('mousemove', e => {
    if (!isDragging) return;
    const el = e.target.closest('.ws-cell');
    if (el) onMove(+el.dataset.r, +el.dataset.c);
  });
  window.addEventListener('mouseup', onEnd);
  container.addEventListener('touchstart', e => {
    e.preventDefault();
    const t = e.touches[0];
    const el = document.elementFromPoint(t.clientX, t.clientY);
    if (el && el.classList.contains('ws-cell')) onStart(+el.dataset.r, +el.dataset.c);
  }, {passive: false});
  container.addEventListener('touchmove', e => {
    e.preventDefault();
    const t = e.touches[0];
    const el = document.elementFromPoint(t.clientX, t.clientY);
    if (el && el.classList.contains('ws-cell')) onMove(+el.dataset.r, +el.dataset.c);
  }, {passive: false});
  container.addEventListener('touchend', e => {
    e.preventDefault(); onEnd();
  }, {passive: false});
}

function restartGame() {
  document.getElementById('modalOverlay').classList.remove('show');
  foundWords = new Set(); selectedCells = [];
  startCell = null; isDragging = false;
  buildGrid(); renderGrid(); renderWords(); initEvents(); startTimer();
}

// INIT
buildGrid(); renderGrid(); renderWords(); initEvents(); startTimer();
</script>

</body>
</html>
